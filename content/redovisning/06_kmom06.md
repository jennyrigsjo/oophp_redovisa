---
---
Redovisning kmom06
=========================

### Hur gick det att jobba med klassen för filtrering och formatting av texten?

Generellt gick det bra. När jag använde klassen för att formatera texterna i [Content-databasen](content/index) fick jag dock problem med att klassens markdown-metod wrappade texten med &lt;code&gt; och &lt;pre&gt;-taggar. Orsaken till detta visade sig vara att det automatiskt läggs till extra whitespace kring texten när man redigerar den i Edit-sidans textfält. Problemet löstes genom att köra *trim()* på texten i klassens parse-metod, innan övriga filter tillämpas. Förutom trim() körs även *strip_tags()* på texten innan den formateras, dock med undantag för &lt;br&gt;-taggar så att användaren kan lägga till extra radbrytningar om han/hon så önskar.

Vid valideringen av klassen fick jag felmeddelandet "Avoid unused private methods". Jag är inte helt på det klara med varför felmeddelandet dök upp, men det skulle kunna bero på att jag använder s.k. <a href="https://php.net/manual/en/functions.variable-functions.php">variable functions</a> i parse-metoden för att anropa klassens privata metoder, vilket får det att verka som om de inte används. Hur som helst löste jag problemet genom att tagga klassen med "@SuppressWarnings(PHPMD.UnusedPrivateMethod)" i klassens docBlock-beskrivning, funderar dock på hur "bra" denna lösning egentligen är. Jag fick ett liknande felmeddelande om att undvika "static access" till klassen Michelf\\Markdown, vilket jag löste genom att lägga till taggen "@SuppressWarnings(PHPMD.StaticAccess)".

### Berätta om din klasstruktur och kodstruktur för din lösning av webbsidor med innehåll i databasen.

I enlighet med tipsen för uppgiften har jag skapat en Content-klass för generell hantering av innehållet (skapa, redigera, radera etc.). Metoderna för mer specifika åtgärder, t.ex. att visa alla sidor eller bloggposter samt att visa en specifik sida eller blogpost har jag lagt i separata subklasser, *Blog* respektive *Page*. Jag har även skapat klassen *User* (som inte är en subklass till Content) med en metod som sköter verifieringen av användarnamn och lösenord i samband med inloggning. När jag skapade klasserna Blog och Page var jag tvungen att ändra synligheten på $db-variabeln i klassen Content från "private" till "protected" så att den kan kommas åt av subklasserna. Hur klokt detta är kan säkert diskuteras, alternativet hade annars varit att överlagra variabeln *$db* och därmed också konstruktorn i subklasserna, vilket kändes som onödigt mycket upprepning av kod.

Jag har valt att låta en enda route (resultAction) i kontrollerklassen ta hand om renderingen av allt innehåll, vilket innebär att övriga routes redirectar till denna route när de har anropat databasen. Resultatet av anropet sparas i sessionen. Fördelen med detta är att all rendering av vyer och innehåll hanteras av en och samma route, man behöver aldrig fundera på vilken route som har renderat en viss sida. Nackdelen är att det inte går göra refresh på eller backa till föregående sida i webbläsaren, eftersom routern inte "minns" från vilken route en sida/ett resultat kommer och därmed inte kan upprepa den senaste åtgärden.

Jag har lagt till extrafunktioner i form av stöd för flashminne, inloggning med admin/doe, återställning av raderat innehåll (s.k. "soft delete") samt funktioner för paginering och sortering av innehållet.

Flashminnet används främst vid in- och utloggning samt för att visa olika typer av felmeddelanden. Lösenorden lagras i hashad form i databasen med hjälp av sha1-algoritmen. I en vidareutveckling av programmet, där användarna på egen hand kan välja användarnamn och lösenord, hade det kanske varit lämpligare att använda någon form av kryptering för att göra det möjligt för användarna att se sina lösenord i klartext efter att de loggat in. Efter inloggning går det att redigera och radera innehåll via sidan *Show all content*, och i navbaren visas även en länk för att lägga till nytt innehåll (*Add new content*). Länken för att återställa databasen borde väl egentligen också "skyddas" av inloggningsfunktionen, dock har jag valt att låta denna vara tillgänglig även utan inloggning i händelse av att databasen skulle gå sönder när man leker runt med programmet.

Jag har skrivit om koden/routen för att återställa databasen så att den inte längre är beroende av inloggningsinformationen i <code>redovisa/src/config/config.php</code>, utan istället kan hämta denna direkt från <code>redovisa/config/database.php</code>. För att åstadkomma detta använde jag ramverkets Configure-modul. Det känns bra att på detta sätt kunna ha inloggningsinformationen för databasen samlad på ett enda ställe i repot, snarare än att ha den sparad i flera olika filer.

### HUr känner du rent allmänt för den koden du skrivit i din me/redovisa, vad är bra och mindre bra?

Jag har successivt blivit bättre på att hantera och utnyttja ramverkets moduler, framför allt under de senaste två kursmomenten. Jag är också ganska nöjd med hur jag skriver mina kontrollerklasser, varje enskild route/action är relativt tunn i och med att jag har förlagt mycket av koden till separata klasser och filer. Jag utnyttjar en del av appkontrollerns "inbyggda" metoder som t.ex. initialize och indexAction, min ambition är dock att bli ännu bättre i detta avseende. Generellt tycker jag att jag skriver ganska välstrukturerade klasser, men koden i dem skulle säkert bli ännu bättre om jag utnyttjade arvsmekanismen lite effektivare (t.ex. skulle jag säkert kunna spara ett antal kodrader om jag modifierade metoden showAll i klassen Content så att denna kan anropas/utnyttjas av subklasserna Blog och Page). Hade jag haft mer tid på mig hade jag även övervägt att flytta den hårdkodade SQL-koden från mina klasser/metoder och istället spara denna i lagrade procedurer inuti själva databasen, i stil med det vi gjorde i kursen *databas*.

### Ser du potential till refactoring av din kod och/eller behov av stöd från ramverket?

Klassen <code>redovisa/src/Content/User.php</code> skulle med ett mått av refactoring kunna återanvändas i flera olika sammanhang och projekt &mdash; det man framför allt behöver göra är att lägga till en medlemsvariabel för namnet på databastabellen som användarinformationen hämtas från, så att namnet kan anpassas beroende på vilken tabell som används. Även en del av funktionerna i <code>redovisa/src/function/function.php</code> (t.ex. validateSort och validateHitsRange) skulle genom smärre modifikationer kunna generaliseras så att de kan användas av andra program inom ramverket, utan att bakåtkompatibiliteten för den skull påverkas. I skrivande stund kan jag inte komma på något som jag tycker "saknas" i ramverket, tvärtom &mdash; jag tror snarare att jag under de kommande veckorna kommer att upptäcka att ramverket innehåller en hel del funktionalitet och stöd som jag ännu inte har hunnit utforska.

### Vilken är din TIL för detta kmom?

Min TIL för detta kursmoment är den generella observationen att jag vid det här laget har ett relativt gott grepp om grunderna för hur man skriver klasser och kontrollerklasser, men att det fortfarande finns en del utrymme för förbättring i detta avseeende. Jag har ägnat en del övertid åt att lösa vissa av extrauppgifterna i det här kursmomentet, förhoppningsvis kommer åtminstone en del av koden jag skrivit i detta avseende (t.ex. inloggning samt funktionerna för paginering och sortering) att vara till nytta när jag nu ska ta mig an projektet.
